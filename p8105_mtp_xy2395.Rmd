---
title: "p8105_mtp_xy2395"
author: "Jack Yan"
date: "10/16/2018"
output: github_document
---
(3-5 figures is sufficient.)
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggridges)
library(patchwork)
library(ggplot2)
```

First, load, tidy, and otherwise wrangle the data. Your final dataset should include all originally observed variables and values; have `useful variable names`; and code data with `reasonable variable classes`. `Describe the resulting dataset` (e.g. what variables exist, how many observations, etc). 
# Data Import and EDA

## Data Import and Cleaning

```{r}
# Import and clean the dataset
motion_data = 
  read_csv("./data/p8105_mtp_data.csv") %>% 
  janitor::clean_names() %>% 
  gather(key = minute, value = activity, activity_1:activity_1440) %>% 
  mutate(
    minute = str_replace(minute, "activity_", "") %>% as.integer(),
    day = as.factor(day),
    day = forcats::fct_relevel(day, c("Sunday", "Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"))
  ) %>% 
  mutate(
    day_num = ((week - 1) * 7 + as.numeric(day)) %>% as.integer(),
    hour = as.integer(minute/60) %>% as.factor()
  ) %>% 
  select(day_num, week, day, minute, hour, activity) %>% 
  arrange(week, day, minute) 
```

The original dataset consists of 239 rows and 1442 variables, and each row has the activity data for a single day. The variable `day` denotes the day in a week, and `week` denotes number of weeks. The 1440 `activity_*` variables denote the measure of activity for 1440 minutes (60 minumtes / hour $\times$ 24 hours) in a day. Such data structure is not tidy, so I use `gather` function to aggregate all the values in the 1440  `activity_*` variables to a single variable, `activity` and put variable names into a new variable, `minute`. Then I truncate the extra 'activity_' string in the `minute` variable and change it to integer. The next thing is to change the `day` variable to factor and relevel them. 

So far, the dataset has been cleaned and all the original values are preserved. But for further analysis, it may be helpful to create a `day_num` variable that denotes number of days past the beginning of the program, and variable `hour` that denotes the the hour in a day.

As a final step, the variables and observations are arranged in a reasonable order. Now, the final dataset has `r nrow(motion_data)` observations and `r ncol(motion_data)`. As described above, the `activity` variable contains all the activity measurement in each minute. `day_num` and `hour` are newly created variables that may facilitate grouping in the analysis.

```{r }
# Check final dataset  
str(motion_data)
motion_data
```

## Exploratory Data Analysis
(Discuss any additional exploratory analyses you conduct, but only include results you think are interesting (e.g. visually inspect distributions for outliers, but include only if these are informative).)

```{r}
# Showing interesting outliers and abnormal values
# scatter plot for daily activity
plot_days = 
motion_data %>% 
  group_by(day_num) %>% 
  summarize(sum = sum(activity)) %>% 
  ggplot(aes(x = day_num, y = sum)) +
    geom_point() +
    labs(
      title = "Distribution of Daily Activity",
      x = "Day #",
      y = "Daily Activity"
    )
# scatter plot for weekly activity
plot_weeks =
motion_data %>% 
  group_by(week) %>% 
  summarize(sum = sum(activity)) %>% 
  ggplot(aes(x = week, y = sum)) +
    geom_point() +
    labs(
      title = "Distribution of Weekly Activity",
      x = "Week #",
      y = "Weekly Activity"
    )

# combine two plots above
plot_days + plot_weeks 
```

As shown in the first plot above, for some given days, activity measurement was close to zero. The sum of activity values for those days are 1440 because the default value for non-activity is 1 for each minute. It is not likely that the person wasn't moving at all in the whole day. It is more plausible to imply that the activity data was not recorded in these days, maybe because the person was not wearing the gear or because the gear was broken down these days. In the plot showing weekly activity, total activity in some weeks at the beginning are extremely lower than other weeks.

# Total activity across days
## Daily and Weekly Trend
(Traditional analyses of accelerometer data focus on the `total activity over the day`. Using your tidied dataset, aggregate across minutes to create a `total activity variable`. 

Using these data, explore the hypothesis that this participant became `more active` over time. You may want to make comparisons visually and / or quantitatively, or using formal statistical analyses. )

The `total_activity` variable contains the sum of activity for each day. To see if this participant became more active over time, plot the daily total activity among days, and among weeks. The trends lines are plotted using `geom_smooth`. As shown in the first plot, although the scatterplot does not show an obvious trend of increased activity, the trend line does get increased over time. As shown more clearly in the second plot, the weekly aggregate activity increased over time. 

```{r}
total_activity = 
  motion_data %>% 
  group_by(day_num) %>% 
  summarize(
    sum = sum(activity)
  )

# plot trend across days
trend_days = 
  total_activity %>% 
  ggplot(aes(x = day_num, y = sum)) +
    geom_point() +
    geom_smooth(method = 'lm', se = FALSE) +
    labs(
      title = "Trend of Daily Activity",
      x = "Day #",
      y = "Daily Total Activity"
    )

sum_of_week = 
  motion_data %>% 
  group_by(week) %>% 
  summarize(
    sum = sum(activity)
  )

# plot trend across weeks
trend_weeks = 
  sum_of_week %>% 
  ggplot(aes(x = week, y = sum)) +
    geom_point() +
    geom_line() +
    geom_smooth(method = 'lm',se = FALSE) +
    labs(
      title = "Trend of Weekly Activity",
      x = "Week #",
      y = "Weekly Total Activity"
    )
trend_days + trend_weeks
```

## Activity in Day of the Week 
((Additionally, examine the possibility that day of the week affects activity (in isolation and in addition to the effect of time).))

```{r}
total_activity_dow = 
  motion_data %>% 
  group_by(week,day,day_num) %>%
  summarize(sum = sum(activity)) %>% 
  ggplot(aes(x = sum, y = day)) + 
  geom_density_ridges(scale = .85)+
  labs(
    y = "Day of the Week",
    x = "Activity",
    title = "Distribution of Activity by Day of the Week"
  )

trend_days_by_dow = 
  motion_data %>% 
  group_by(week,day,day_num) %>%
  summarize(sum = sum(activity)) %>% 
  ggplot(aes(x = week, y = sum, color = day)) +
    geom_point() +
    geom_smooth(method = 'lm', se = FALSE) +
    labs(
      title = "Trend of Activity by Day of Week",
      x = "Week #",
      y = "Total Activity"
    ) 
  #  facet_grid(~ day)

total_activity_dow + trend_days_by_dow
 trend_days_by_dow
```

The first graph above shows the density distribution of activity by day of the week. We can see in this graph that the distribution of activity differs significantly among different days in a week. . The second plot shows that the trends of activity by different days of week are different. The activity increased for all days of the week in the first 15 weeks, then had different patterns in the following weeks. 

# Activity over the course of a day

(((One advantage of accelerometer data is the ability to inspect activity `over the course of the day`, rather than aggregating over 24 hours. Explore the `distribution` of activity counts in the full dataset, taking into account `other variables of interest`.

Make a visualization that shows the `24-hour activity “profiles”` for each day. 

Also visualize effects of `time` and `day of the week` on 24-hour activity profiles; incorporating smooth estimates of mean activity profiles may clarify these effects.

Comment on relationships you think are interesting. (No formal statistical analyses are needed.)))


```{r, eval=F}
# 24-hour activity “profiles”
# heatmap 
day_heatmap =
motion_data %>% 
  group_by(day_num, hour) %>%
  summarize(mean_activity = mean(activity)) %>% 
  ggplot(aes(x = hour, y = day_num, fill = mean_activity)) +
    geom_tile()
# take days into account?

# take weeks into account?
week_heatmap =
  motion_data %>% 
  group_by(hour) %>% 
  ggplot(aes(x = hour, y = week)) +
    geom_roaster(aes(fill = activity))
```

```{r}
# visualize effects of time and day of the week on 24-hour activity profiles
# effect of day of the week on 24-hour activity profiles
activity_profile_dow =
  motion_data %>% 
  group_by(day,hour) %>%
  summarize(mean_activity = mean(activity)) %>% 
  ggplot(aes(x = hour, y = mean_activity, group = day, color = day)) +
    geom_smooth(se = FALSE)

# effect of week number on 24-hour activity profiles
activity_profile_week = 
  motion_data %>% 
  group_by(week, day_num, day,hour) %>%
  summarize(mean_activity = mean(activity)) %>% 
  ggplot(aes(x = hour, y = mean_activity, group = week, color = week)) +
    geom_smooth(se = FALSE, size = 0.5)

activity_profile_dow + activity_profile_week
```


